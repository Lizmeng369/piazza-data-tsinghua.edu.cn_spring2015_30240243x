{"aid": "ilqpyqejkq02ja", "result": {"folders": ["lab2"], "unique_views": 19, "no_answer": 1, "change_log": [{"data": "ilqm4isolei7ir", "anon": "full", "when": "2016-03-13T13:44:25Z", "type": "create"}], "upvote_ids": [], "id": "ilqm4ism6d7iq", "bookmarked": 3, "no_answer_followup": 0, "i_edits": [], "is_bookmarked": false, "children": [], "request_instructor_me": false, "nr": 686, "bucket_order": 2, "config": {}, "status": "active", "tags": ["lab2", "student", "unanswered"], "num_favorites": 0, "bucket_name": "Today", "q_edits": [], "data": {"embed_links": []}, "request_instructor": 0, "created": "2016-03-13T13:44:25Z", "is_tag_good": false, "type": "question", "s_edits": [], "my_favorite": false, "default_anonymity": "no", "t": 1457883114283, "tag_good": [], "tag_good_arr": [], "history": [{"content": "<p>为什么要把所有page连起来呢&#xff1f;难道不是按块来管理吗&#xff1f;</p>\n<p></p>\n<pre>参考答案的代码&#xff1a;<br />static void\ndefault_init_memmap(struct Page *base, size_t n) {\n    assert(n &gt; 0);\n    struct Page *p = base;\n    for (; p != base &#43; n; p &#43;&#43;) {\n        assert(PageReserved(p));\n        p-&gt;flags = 0;\n        SetPageProperty(p);\n        p-&gt;property = 0;\n        set_page_ref(p, 0);\n        list_add_before(&amp;free_list, &amp;(p-&gt;page_link));\n    }\n    nr_free &#43;= n;\n    //first block\n    base-&gt;property = n;\n}<br /><br />我所认为的代码&#xff1a;<br />static void\ndefault_init_memmap(struct Page *base, size_t n) {\n    assert(n &gt; 0);\n    struct Page *p = base;\n    for (; p != base &#43; n; p &#43;&#43;) {\n        // 检查预留位\n        assert(PageReserved(p));\n        // 清空标志位flags=0&#xff0c;设置为非块property=0\n        p-&gt;flags = p-&gt;property = 0;\n        // 设置引用计数为0\n        set_page_ref(p, 0);\n    }\n    // 设置property标志位&#xff0c;使得base-&gt;property有效&#xff0c;表示base为块\n    SetPageProperty(base);\n    base-&gt;property = n;\n    nr_free &#43;= n;\n}</pre>\n<p></p>\n<p>包括参考答案中的alloc和free&#xff0c;也都在分配或回收内存块时&#xff0c;对块内所有的页进行链表操作。</p>\n<p>如此看来&#xff0c;<strong>ucore管理页帧的链表&#xff0c;不是内存块的链表&#xff0c;而是页的链表</strong>。是吗&#xff1f;</p>\n<p>我的理解是&#xff0c;页帧按块管理&#xff0c;即链表中只有页块。分配和回收时&#xff0c;会有对页标志位的操作&#xff0c;但每次分配和回收&#xff0c;链表只可能有1~2个节点的波动&#xff0c;而不是像lab2_ans那样一大串链表操作。我猜想是否ucore某些框架部分可能用到&#xff0c;但在lab2这里还未体现&#xff1f;</p>\n<p></p>", "anon": "full", "subject": "关于lab2的default_init_memmap的Page管理", "created": "2016-03-13T13:44:25Z"}]}, "error": null}