{"error": null, "result": {"nr": 256, "upvote_ids": [], "change_log": [{"type": "create", "when": "2015-04-08T06:09:47Z", "uid": "hdjonbiyfs62ie", "data": "i88c686t3fi2tl", "anon": "no"}, {"type": "followup", "to": "i88c68612ac2tk", "when": "2015-04-08T06:35:32Z", "uid": "i6s09f3xHOf", "anon": "no"}, {"type": "followup", "to": "i88c68612ac2tk", "when": "2015-04-08T06:49:30Z", "uid": "i6uunp7jxDb", "anon": "no"}, {"type": "feedback", "to": "i88c68612ac2tk", "when": "2015-04-09T01:12:21Z", "uid": "hdjonbiyfs62ie", "anon": "no"}, {"type": "feedback", "to": "i88c68612ac2tk", "when": "2015-04-09T01:12:29Z", "uid": "hdjonbiyfs62ie", "anon": "no"}], "q_edits": [], "i_edits": [], "unique_views": 61, "bookmarked": 5, "config": {}, "history": [{"subject": "每个线程有几个堆栈&#xff1f;", "content": "<p>每个线程都有自己的堆栈&#xff0c;但有几个就有疑问了。请在线程创建代码中找到相应堆栈的创建代码。</p>\n<p></p>\n<p>请有兴趣的同学&#xff0c;回复自己的看法。也欢迎有疑问的同学提问。大家一起来讨论&#xff0c;把问题搞清楚。</p>", "created": "2015-04-08T06:09:47Z", "uid": "hdjonbiyfs62ie", "anon": "no"}], "data": {"embed_links": []}, "request_instructor_me": false, "folders": ["课堂问答"], "type": "note", "tag_good": [], "tag_good_arr": [], "created": "2015-04-08T06:09:47Z", "t": 1433500272297, "id": "i88c68612ac2tk", "status": "active", "default_anonymity": "no", "my_favorite": false, "bucket_order": 2, "is_bookmarked": false, "is_tag_good": false, "bucket_name": "Today", "no_answer_followup": 0, "children": [{"no_upvotes": 0, "uid": "i6s09f3xHOf", "bucket_name": "Yesterday", "bucket_order": 3, "updated": "2015-04-08T06:35:32Z", "config": {}, "d-bucket": "Yesterday", "data": {"embed_links": null}, "anon": "no", "folders": [], "subject": "<p>感觉每个线程有两个堆栈&#xff0c;一个用户态一个内核态&#xff0c;所有线程的内核态公用一个堆栈</p>\n<p>entry.S中初始化了内核态堆栈<br />relocated:<br /> # set ebp, esp<br /> movl $0x0, %ebp<br /> # the kernel stack region is from bootstack -- bootstacktop,<br /> # the kernel stack size is KSTACKSIZE (8KB)defined in memlayout.h<br /> movl $bootstacktop, %esp<br /> # now kernel stack is ready , call the first C function<br /> call kern_init</p>\n<p>proc.c中alloc_proc()中初始化context时初始化了用户态堆栈<br />struct context {<br /> uint32_t eip;<br /> uint32_t esp;<br /> uint32_t ebx;<br /> uint32_t ecx;<br /> uint32_t edx;<br /> uint32_t esi;<br /> uint32_t edi;<br /> uint32_t ebp;<br />};</p>", "children": [{"uid": "hdjonbiyfs62ie", "bucket_name": "Today", "bucket_order": 2, "updated": "2015-04-09T01:12:21Z", "config": {}, "anon": "no", "data": {"embed_links": null}, "folders": [], "subject": "<p>好评。</p>", "children": [], "type": "feedback", "created": "2015-04-09T01:12:21Z", "id": "i89gzkh1wze40e"}], "type": "followup", "no_answer": 0, "created": "2015-04-08T06:35:32Z", "id": "i88d3cf474t3rk"}, {"no_upvotes": 0, "uid": "i6uunp7jxDb", "bucket_name": "Yesterday", "bucket_order": 3, "updated": "2015-04-08T06:49:30Z", "config": {}, "d-bucket": "Yesterday", "data": {"embed_links": null}, "anon": "no", "folders": [], "subject": "<p>Kernel:</p>\n<pre>proc.c \ndo_fork():\n\nif (setup_kstack(proc) != 0) {\n    goto bad_fork_cleanup_proc;\n}\n\nsetup_kstack(struct proc_struct *proc) {\n    struct Page *page = alloc_pages(KSTACKPAGE);\n    if (page != NULL) {\n        proc-&gt;kstack = (uintptr_t)page2kva(page);\n        return 0;\n    }\n    return -E_NO_MEM;\n}</pre>\n<p>User: </p>\n<pre>proc.c\nalloc_proc():\nmemset(&amp;(proc-&gt;context), 0, sizeof(struct context));\n\nproc.h\nstruct context {\n    uint32_t eip;\n    uint32_t esp;\n    uint32_t ebx;\n    uint32_t ecx;\n    uint32_t edx;\n    uint32_t esi;\n    uint32_t edi;\n    uint32_t ebp;\n};<br /><br />copy_thread(struct proc_struct *proc, uintptr_t esp, struct trapframe *tf) {\n    proc-&gt;tf = (struct trapframe *)(proc-&gt;kstack &#43; KSTACKSIZE) - 1;\n    *(proc-&gt;tf) = *tf;\n    proc-&gt;tf-&gt;tf_regs.reg_eax = 0;\n    proc-&gt;tf-&gt;tf_esp = esp;\n    proc-&gt;tf-&gt;tf_eflags |= FL_IF;\n\n    proc-&gt;context.eip = (uintptr_t)forkret;\n    proc-&gt;context.esp = (uintptr_t)(proc-&gt;tf);\n}</pre>", "children": [{"uid": "hdjonbiyfs62ie", "bucket_name": "Today", "bucket_order": 2, "updated": "2015-04-09T01:12:29Z", "config": {}, "anon": "no", "data": {"embed_links": null}, "folders": [], "subject": "<p>好评。</p>", "children": [], "type": "feedback", "created": "2015-04-09T01:12:29Z", "id": "i89gzr2s2tf42w"}], "type": "followup", "no_answer": 0, "created": "2015-04-08T06:49:30Z", "id": "i88dlaff1ek48e"}], "request_instructor": 0, "tags": ["instructor-note", "课堂问答"], "s_edits": [], "num_favorites": 0}, "aid": "iajh1t49vjz4lc"}