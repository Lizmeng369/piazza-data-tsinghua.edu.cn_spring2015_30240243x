{"error": null, "result": {"nr": 218, "upvote_ids": [], "change_log": [{"type": "create", "when": "2015-03-31T13:26:43Z", "uid": "i6un8w0cKfP", "data": "i7xc9asjqvy5xu", "anon": "no"}, {"type": "update", "when": "2015-03-31T13:50:26Z", "uid": "i6un8w0cKfP", "data": "i7xd3sw6qcx7nk", "anon": "no"}, {"uid": "i6un8w0cKfP", "to": "i7xc9ashjl65xt", "when": "2015-03-31T13:58:43Z", "anon": "no", "data": "i7xdegcyg2x30t", "type": "s_answer"}, {"type": "s_answer_update", "when": "2015-03-31T13:59:01Z", "uid": "i6un8w0cKfP", "data": "i7xdeu4pn7f365", "anon": "no"}, {"type": "s_answer_update", "when": "2015-03-31T14:09:52Z", "uid": "i6un8w0cKfP", "data": "i7xdssxqe846ef", "anon": "no"}, {"when": "2015-03-31T14:13:33Z", "anon": "full", "data": "i7xdxjm467onk", "type": "s_answer_update"}, {"to": "i7xc9ashjl65xt", "when": "2015-03-31T14:13:51Z", "anon": "full", "type": "followup"}, {"type": "followup", "to": "i7xc9ashjl65xt", "when": "2015-03-31T17:40:25Z", "uid": "i6uqzf449em3ex", "anon": "no"}, {"type": "followup", "to": "i7xc9ashjl65xt", "when": "2015-04-01T01:32:23Z", "uid": "hcrrjuyequh4bt", "anon": "no"}, {"uid": "hdjoucuyb836fq", "to": "i7xc9ashjl65xt", "when": "2015-04-01T02:38:41Z", "anon": "no", "data": "i7y4jrvayk82lt", "type": "i_answer"}, {"type": "i_answer_update", "when": "2015-04-01T02:58:21Z", "uid": "hdjoucuyb836fq", "data": "i7y592ghm2b3o7", "anon": "no"}, {"type": "i_answer_update", "when": "2015-04-01T02:59:32Z", "uid": "hdjoucuyb836fq", "data": "i7y5alkw5kf1mk", "anon": "no"}, {"type": "i_answer_update", "when": "2015-04-01T03:04:34Z", "uid": "hsfa0sawctb6v4", "data": "i7y5h2dktlb1ub", "anon": "no"}, {"to": "i7xc9ashjl65xt", "when": "2015-04-01T12:54:07Z", "anon": "full", "type": "feedback"}, {"type": "feedback", "to": "i7xc9ashjl65xt", "when": "2015-04-01T13:00:35Z", "uid": "i6un8w0cKfP", "anon": "no"}, {"type": "feedback", "to": "i7xc9ashjl65xt", "when": "2015-04-01T13:01:11Z", "uid": "i6un8w0cKfP", "anon": "no"}, {"type": "update", "when": "2015-04-07T07:45:06Z", "uid": "hs2sszxmgag6jq", "data": "i8704yh3who51q", "anon": "no"}, {"type": "update", "when": "2015-04-07T08:03:33Z", "uid": "hs2sszxmgag6jq", "data": "i870so8truy2do", "anon": "no"}], "q_edits": [], "i_edits": [], "unique_views": 64, "bookmarked": 8, "config": {}, "history": [{"subject": "iret在什么情况下会把%gs变成0&#xff1f;", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>", "created": "2015-04-07T08:03:33Z", "uid": "hs2sszxmgag6jq", "anon": "no"}, {"subject": "iret在什么情况下会把%gs变成0&#xff1f;", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>\n#pin", "created": "2015-04-07T07:45:06Z", "uid": "hs2sszxmgag6jq", "anon": "no"}, {"subject": "iret在什么情况下会把%gs变成0&#xff1f;", "content": "<p>我以为没人会动这玩意结果调了一天。。</p>", "created": "2015-03-31T13:50:26Z", "uid": "i6un8w0cKfP", "anon": "no"}, {"subject": "iret在什么情况下会把%gs变成0&#xff1f;", "content": "<p>如题所问 搜索未果</p>", "created": "2015-03-31T13:26:43Z", "uid": "i6un8w0cKfP", "anon": "no"}], "data": {"embed_links": []}, "request_instructor_me": false, "folders": ["big_proj"], "type": "question", "tag_good": [], "no_answer": 0, "created": "2015-03-31T13:26:43Z", "t": 1433500231011, "id": "i7xc9ashjl65xt", "status": "active", "tag_good_arr": [], "default_anonymity": "no", "my_favorite": false, "bucket_order": 2, "is_bookmarked": false, "is_tag_good": false, "bucket_name": "Today", "no_answer_followup": 0, "children": [{"folders": [], "bucket_order": 2, "config": {}, "history": [{"subject": "", "content": "<p></p>", "created": "2015-03-31T14:13:33Z", "anon": "full"}, {"subject": "", "content": "<p>这个也许有帮助</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a></p>", "created": "2015-03-31T14:09:52Z", "uid": "i6un8w0cKfP", "anon": "no"}, {"subject": "", "content": "<p>然后我发现了这个</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a></p>", "created": "2015-03-31T13:59:01Z", "uid": "i6un8w0cKfP", "anon": "no"}, {"subject": "", "content": "<p>然后我发现了这个</p>\n<p>http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</p>", "created": "2015-03-31T13:58:43Z", "uid": "i6un8w0cKfP", "anon": "no"}], "data": {"embed_links": []}, "bucket_name": "Today", "is_tag_endorse": false, "children": [], "tag_endorse": [], "tag_endorse_arr": [], "created": "2015-03-31T13:58:43Z", "id": "i7xdegb3ywa30s", "type": "s_answer"}, {"no_upvotes": 0, "bucket_name": "Last week", "bucket_order": 5, "updated": "2015-03-31T14:13:51Z", "config": {}, "anon": "full", "data": {"embed_links": null}, "folders": [], "subject": "<p>这个也许有帮助</p>\n<p><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\">http://osdir.com/ml/qemu-devel/2010-03/msg01830.html</a><a href=\"http://osdir.com/ml/qemu-devel/2010-03/msg01830.html\" target=\"_blank\"></a></p>\n<p>似乎确实是会清的</p>\n<p>我仍然不明白它闲着没事清俩寄存器有什么作用</p>", "children": [], "type": "followup", "no_answer": 0, "created": "2015-03-31T14:13:51Z", "id": "i7xdxx0qux81tt"}, {"no_upvotes": 0, "uid": "i6uqzf449em3ex", "bucket_name": "Last week", "bucket_order": 5, "updated": "2015-03-31T17:40:25Z", "config": {}, "anon": "no", "data": {"embed_links": null}, "folders": [], "subject": "<p>不是iret清零的吧&#xff0c;是那个popl %gs吧&#xff1f;</p>", "children": [{"folders": [], "bucket_order": 5, "updated": "2015-04-01T12:54:07Z", "config": {}, "anon": "full", "data": {"embed_links": null}, "bucket_name": "Last week", "subject": "<p>确实是iret清的 我以为设了tf_gs就没事了 结果调死我了 单步了一晚上才发现</p>", "children": [], "type": "feedback", "created": "2015-04-01T12:54:07Z", "id": "i7yqj8pwgfnow"}, {"uid": "i6un8w0cKfP", "bucket_name": "Last week", "bucket_order": 5, "updated": "2015-04-01T13:01:11Z", "config": {}, "anon": "no", "data": {"embed_links": null}, "folders": [], "subject": "<p>不小心匿名了。。</p>\n<p>前面那个pop %gs带有强烈的误导性&#xff0c;一个会被iret修改的东西不需要push再pop&#xff0c;所以我根本没怀疑过iret会动这玩意。现在看来是qemu写错了&#xff0c;气死我了。。</p>", "children": [], "type": "feedback", "created": "2015-04-01T13:01:11Z", "id": "i7yqsbk62jlwk"}], "type": "followup", "no_answer": 0, "created": "2015-03-31T17:40:25Z", "id": "i7xlbkn6r153ht"}, {"no_upvotes": 0, "uid": "hcrrjuyequh4bt", "bucket_name": "Last week", "bucket_order": 5, "updated": "2015-04-01T01:32:23Z", "config": {}, "anon": "no", "data": {"embed_links": null}, "folders": [], "subject": "<p>iret 会根据 kernel stack返回到内核空间和用户空间&#xff0c;并修改部分寄存器&#xff0c;但不包括GS.</p>\n<p>你在哪段代码调试中发现了这个问题?</p>\n<p>你的代码放在哪里? 我想看看。</p>\n<p>你的qemu的版本是?</p>", "children": [{"uid": "i6un8w0cKfP", "bucket_name": "Last week", "bucket_order": 5, "updated": "2015-04-01T13:00:35Z", "config": {}, "anon": "no", "data": {"embed_links": null}, "folders": [], "subject": "<p>你在哪段代码调试中发现了这个问题?</p>\n<p>我在iret回用户程序之后会莫名其妙的崩溃&#xff0c;经过调试发现&#xff05;gs变成0了&#xff0c;单步后发现被iret清了&#xff0c;只有在ring0到3外加一些条件才会发生。</p>\n<p>我原以为iret不会修改gs&#xff0c;用户程序也不能修改段寄存器&#xff0c;所以直接在trapframe中设定gs&#xff0c;以为这个量可以留住。</p>\n<p>你的代码放在哪里? 我想看看。</p>\n<p><a href=\"https://github.com/glglwty/ucore_lab/tree/a61a5a5603dd7b9940ddc08bbc35c0ac0d315038\">https://github.com/glglwty/ucore_lab/tree/a61a5a5603dd7b9940ddc08bbc35c0ac0d315038</a></p>\n<p>断点设定在trapentry.S的trapret&#xff0c;pop %gs后查看gs正常&#xff0c;iret执行后立刻变成0。</p>\n<div>\n<div>\n<p>你的qemu的版本是?</p>\n</div>\n</div>\n<div>\n<div>\n<div>\n<div>QEMU emulator version 2.1.0 (Debian 2.1&#43;dfsg-4ubuntu6.4), Copyright (c) 2003-2008 Fabrice Bellard</div>\n</div>\n</div>\n</div>", "children": [], "type": "feedback", "created": "2015-04-01T13:00:35Z", "id": "i7yqrk1k9ymgg"}], "type": "followup", "no_answer": 0, "created": "2015-04-01T01:32:23Z", "id": "i7y26ik8ewsbh"}, {"folders": [], "bucket_order": 2, "config": {}, "history": [{"subject": "", "content": "<p>x86手册中iret的定义没有修改gs的可能&#xff0c;但是在qemu里执行在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0&#xff08;理由不明&#xff09;。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>\n<p></p>\n<p>把GS所指的描述符的DPL设成3&#xff0c;应该就没有问题了</p>", "created": "2015-04-01T03:04:34Z", "uid": "hsfa0sawctb6v4", "anon": "no"}, {"subject": "", "content": "<p>x86手册中iret的定义没有修改gs的可能&#xff0c;但是在qemu里执行在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0&#xff08;理由不明&#xff09;。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>", "created": "2015-04-01T02:59:32Z", "uid": "hdjoucuyb836fq", "anon": "no"}, {"subject": "", "content": "<p>这个是qemu的行为&#xff0c;在iret时&#xff0c;如果以下条件同时成立&#xff1a;</p>\n<ul><li>GS的高13位非0&#xff1b;</li><li>GS是数据段&#xff08;type域最高位为0&#xff09;&#xff1b;</li><li>GS对应段的dpl小于cpl&#xff08;比如回用户态时&#xff09;。\n<ul></ul>\n</li></ul>\n<p>那么GS会被清成0。</p>\n<p></p>\n<p>一种workaround是在用户进程进入内核时恢复gs&#xff0c;这个gs可以保存在进程的PCB里。</p>", "created": "2015-04-01T02:58:21Z", "uid": "hdjoucuyb836fq", "anon": "no"}, {"subject": "", "content": "<p>请试一下把gs对应段的权限从USER_DS改成KERNEL_DS。</p>", "created": "2015-04-01T02:38:41Z", "uid": "hdjoucuyb836fq", "anon": "no"}], "data": {"embed_links": []}, "bucket_name": "Today", "is_tag_endorse": false, "children": [], "tag_endorse": [], "tag_endorse_arr": [], "created": "2015-04-01T02:38:41Z", "id": "i7y4jrv8w0r2ls", "type": "i_answer"}], "request_instructor": 0, "tags": ["big_proj", "student"], "s_edits": [], "num_favorites": 0}, "aid": "iajh0x9fkkm4hd"}